{% extends "pet_shop/base.html" %}
{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'pet_shop/css/client_dashboard.css' %}">
{% endblock %}
{% block content %}
<div class="container">
        <a href="{% url 'pet_shop:index' %}" class="home-link">На главную</a>

        {% if user.serviceuser.is_employee %}
        <a href="{% url 'pet_shop:statistics' %}" class="stats-link">Статистика магазина</a>
        <a href="{% url 'pet_shop:add_product' %}" class="products-link">Добавить товар</a>
        {% endif %}

        {% if error %}
        <div class="error">{{ error }}</div>
        {% endif %}

        <div class="profile">
            <img src="{% static user.serviceuser.pic.url %}" alt="Фото клиента">
            <div class="user-info">
                <label for="username">Имя пользователя:</label>
                <input type="text" id="username" value="{{ user.username }}" readonly>
                <label for="email">Email:</label>
                <input type="email" id="email" value="{{ user.email }}" readonly>
            </div>
        </div>

        <div class="balance">
            <h3>Баланс счета</h3>
            <p>${{ user.serviceuser.balance }}</p>
        </div>

        <div class="cart">
            <h3>Корзина покупок</h3>
            {% if products %}
            <ul>
                {% for cart_item in products %}
                    <li class="cart-item">
                        <span><strong>{{ cart_item.product.name }}</strong> - ${{ cart_item.product.price }}</span>

                        <div class="quantity-control">
                            <span>Количество: {{ cart_item.quantity }}</span>

                            <form method="post" action="{% url 'pet_shop:update_cart_item_quantity' %}">
                                {% csrf_token %}
                                <input type="hidden" name="cart_item_id" value="{{ cart_item.id }}">
                                <button type="submit" name="action" value="decrease" class="btn qty-btn minus">−</button>
                            </form>

                            <form method="post" action="{% url 'pet_shop:update_cart_item_quantity' %}">
                                {% csrf_token %}
                                <input type="hidden" name="cart_item_id" value="{{ cart_item.id }}">
                                <button type="submit" name="action" value="increase" class="btn qty-btn plus">+</button>
                            </form>
                        </div>

                        <span>Итого: ${{ cart_item.get_total_price }}</span>

                        <form method="post" action="{% url 'pet_shop:buy_product' %}" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="cart_item_id" value="{{ cart_item.id }}">
                            <button type="submit" class="btn buy-btn">Купить</button>
                        </form>

                        <form method="post" action="{% url 'pet_shop:delete_from_cart' %}" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="cart_item_id" value="{{ cart_item.id }}">
                            <button type="submit" class="btn delete-btn">Удалить</button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
            {% else %}
            <p>Ваша корзина пуста</p>
            {% endif %}
        </div>
    </div>
{% endblock %}
