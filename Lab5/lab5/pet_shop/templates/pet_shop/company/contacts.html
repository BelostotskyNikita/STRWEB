{% extends "pet_shop/base.html" %}
{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'pet_shop/css/contacts.css' %}">
{% endblock %}
{% block content %}

<div class="container contact-page">
    <h3 class="contact-header">–ù–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã</h3>
    
    {% if employees %}
        <p style="color: #666; font-size: 12px; margin-bottom: 10px;">–ù–∞–π–¥–µ–Ω–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: {{ employees|length }}</p>
    {% endif %}
    
    {% if employees and employees|length > 0 %}
    <div class="contacts-container">
        {% for employee in employees %}
        <div class="contact-card">
            <div class="contact-card-inner">
                <div class="contact-photo-wrapper">
                    {% with full_name=employee.user.get_full_name|default:employee.user.username %}
                    {% with initial=full_name|first|upper|default:"?" %}
                    {% if employee.pic %}
                        <img src="{{ employee.pic.url }}" alt="{{ full_name }}" class="contact-photo" onerror="handleImageError(this, '{{ initial }}');">
                    {% else %}
                        {% if forloop.counter0 == 0 or forloop.counter0 == 3 or forloop.counter0 == 6 or forloop.counter0 == 9 or forloop.counter0 == 12 %}
                            <img src="{% static 'pet_shop/images/avatar/ava_6.png' %}" alt="{{ full_name }}" class="contact-photo" onerror="handleImageError(this, '{{ initial }}');">
                        {% elif forloop.counter0 == 1 or forloop.counter0 == 4 or forloop.counter0 == 7 or forloop.counter0 == 10 or forloop.counter0 == 13 %}
                            <img src="{% static 'pet_shop/images/avatar/ava_7.png' %}" alt="{{ full_name }}" class="contact-photo" onerror="handleImageError(this, '{{ initial }}');">
                        {% else %}
                            <img src="{% static 'pet_shop/images/avatar/ava_8.png' %}" alt="{{ full_name }}" class="contact-photo" onerror="handleImageError(this, '{{ initial }}');">
                        {% endif %}
                    {% endif %}
                    {% endwith %}
                    {% endwith %}
                </div>

                <div class="contact-info">
                    <h4 class="contact-name">
                        {{ employee.user.get_full_name|default:employee.user.username }}
                    </h4>
                    
                    <div class="contact-description">
                        {{ employee.job_description }}
                    </div>

                    <div class="contact-details">
                        {% if employee.phone %}
                        <div class="contact-detail-item">
                            <span class="contact-icon">üìû</span>
                            <span class="contact-text">
                                {{ employee.phone }}
                            </span>
                        </div>
                        {% else %}
                        <div class="contact-detail-item" style="opacity: 0.5;">
                            <span class="contact-icon">üìû</span>
                            <span class="contact-text">–¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω</span>
                        </div>
                        {% endif %}

                        {% if employee.user.email %}
                        <div class="contact-detail-item">
                            <span class="contact-icon">‚úâÔ∏è</span>
                            <span class="contact-text">
                                {{ employee.user.email }}
                            </span>
                        </div>
                        {% else %}
                        <div class="contact-detail-item" style="opacity: 0.5;">
                            <span class="contact-icon">‚úâÔ∏è</span>
                            <span class="contact-text">Email –Ω–µ —É–∫–∞–∑–∞–Ω</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-contacts">
        <h4>–ö–æ–Ω—Ç–∞–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
        <p>–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</p>
        <p style="font-size: 12px; color: #999; margin-top: 10px;">
            –î–æ–±–∞–≤—å—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å Django –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ñ–ª–∞–≥ is_employee=True
        </p>
    </div>
    {% endif %}
</div>

<script>
function handleImageError(img, initial) {
    img.onerror = null;
    img.style.display = 'none';
    const placeholder = document.createElement('div');
    placeholder.className = 'contact-photo-placeholder';
    placeholder.innerHTML = '<div class="contact-initials">' + initial + '</div>';
    img.parentElement.appendChild(placeholder);
}
</script>
{% endblock %}